<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberScan AI - –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–∞–π—Ç–æ–≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #0a0c10;
            --bg-secondary: #14181f;
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --accent: #3b82f6;
            --accent-glow: rgba(59, 130, 246, 0.5);
            --success: #10b981;
            --success-bg: rgba(16, 185, 129, 0.1);
            --warning: #f59e0b;
            --warning-bg: rgba(245, 158, 11, 0.1);
            --danger: #ef4444;
            --danger-bg: rgba(239, 68, 68, 0.1);
            --info: #3b82f6;
            --info-bg: rgba(59, 130, 246, 0.1);
            --card-bg: #1a1e26;
            --border: #2d3748;
            --border-light: #3a4a5a;
        }

        [data-theme="light"] {
            --bg-primary: #f3f4f6;
            --bg-secondary: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --card-bg: #ffffff;
            --border: #e5e7eb;
            --border-light: #d1d5db;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        .noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj48ZmlsdGVyIGlkPSJmIj48ZmVUdXJidWxlbmNlIHR5cGU9ImZyYWN0YWxOb2lzZSIgYmFzZUZyZXF1ZW5jeT0iLjc0IiBudW1PY3RhdmVzPSIzIiAvPjwvZmlsdGVyPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbHRlcj0idXJsKCNmKSIgb3BhY2l0eT0iMC4wNCIgLz48L3N2Zz4=');
            pointer-events: none;
            opacity: 0.4;
            z-index: 1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 2;
        }

        .navbar {
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo i {
            color: var(--accent);
            filter: drop-shadow(0 0 10px var(--accent-glow));
        }

        .accent {
            color: var(--accent);
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 500;
            cursor: pointer;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--accent);
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            color: var(--accent);
            transform: rotate(180deg);
        }

        .hero {
            padding: 60px 0 40px;
            text-align: center;
        }

        h1 {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 20px;
            position: relative;
            display: inline-block;
        }

        .glitch {
            position: relative;
            animation: glitch 3s infinite;
        }

        .glitch::before,
        .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .glitch::before {
            animation: glitch-top 3s infinite;
            color: #ff00c1;
            z-index: -1;
        }

        .glitch::after {
            animation: glitch-bottom 3s infinite;
            color: #00fff9;
            z-index: -2;
        }

        @keyframes glitch {
            2%, 64% { transform: skew(0deg, 0deg); }
            4%, 60% { transform: skew(0deg, 0deg); }
            62% { transform: skew(0deg, 0deg) translate(5px, -5px); }
        }

        @keyframes glitch-top {
            2%, 64% { transform: translate(2px, -2px); }
            4%, 60% { transform: translate(-2px, 2px); }
            62% { transform: translate(13px, -13px) skew(-13deg); }
        }

        @keyframes glitch-bottom {
            2%, 64% { transform: translate(-2px, 2px); }
            4%, 60% { transform: translate(2px, -2px); }
            62% { transform: translate(-13px, 13px) skew(13deg); }
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin-bottom: 40px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
        }

        .stat-card i {
            font-size: 2rem;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .scan-section {
            padding: 30px 0;
        }

        .scan-card {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid var(--border);
            text-align: center;
        }

        .scan-card h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .scan-description {
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            max-width: 700px;
            margin: 0 auto;
        }

        #urlInput {
            flex: 1;
            padding: 15px 20px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }

        #urlInput:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .scan-button {
            padding: 15px 30px;
            border-radius: 10px;
            border: none;
            background: var(--accent);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
        }

        .scan-button:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .scan-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .results-section {
            padding: 40px 0;
        }

        .result-card {
            background: var(--card-bg);
            border-radius: 20px;
            border: 1px solid var(--border);
            padding: 30px;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .site-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .site-info i {
            color: var(--accent);
            font-size: 1.5rem;
        }

        .site-url {
            font-size: 1.2rem;
            font-weight: 500;
            word-break: break-all;
        }

        .status-badge {
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-badge.safe {
            background: var(--success-bg);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-badge.suspicious {
            background: var(--warning-bg);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .status-badge.dangerous {
            background: var(--danger-bg);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .risk-meter {
            margin-bottom: 30px;
        }

        .risk-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .progress-bar {
            height: 12px;
            background: var(--bg-primary);
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .trust-score {
            text-align: center;
            margin-bottom: 30px;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
            border-radius: 50%;
            background: conic-gradient(var(--accent) calc(var(--percent) * 1%), var(--border) 0);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: var(--card-bg);
        }

        .score-value {
            position: relative;
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            z-index: 2;
        }

        .summary {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 4px solid var(--accent);
        }

        .summary i {
            font-size: 1.8rem;
            color: var(--accent);
        }

        .summary p {
            font-size: 1.1rem;
        }

        .flags-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .flags-section {
            padding: 20px;
            border-radius: 12px;
        }

        .flags-section.green {
            background: var(--success-bg);
            border: 1px solid var(--success);
        }

        .flags-section.red {
            background: var(--danger-bg);
            border: 1px solid var(--danger);
        }

        .flags-section h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }

        .flags-section ul {
            list-style: none;
        }

        .flags-section li {
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }

        .flags-section li:last-child {
            border-bottom: none;
        }

        .flags-section li i.fa-check-circle {
            color: var(--success);
        }

        .flags-section li i.fa-exclamation-circle {
            color: var(--danger);
        }

        .flags-section li i.fa-exclamation-triangle {
            color: var(--warning);
        }

        .phishing-analysis {
            margin-top: 30px;
            padding: 25px;
            background: var(--bg-primary);
            border-radius: 15px;
            border: 1px solid var(--border);
        }

        .phishing-analysis h3 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .phishing-forms {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .phishing-form-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid;
        }

        .phishing-form-card.critical {
            border-left-color: var(--danger);
        }

        .phishing-form-card.high {
            border-left-color: var(--warning);
        }

        .phishing-form-card.medium {
            border-left-color: var(--accent);
        }

        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .form-risk-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .form-risk-badge.critical {
            background: var(--danger-bg);
            color: var(--danger);
        }

        .form-risk-badge.high {
            background: var(--warning-bg);
            color: var(--warning);
        }

        .form-risk-badge.medium {
            background: var(--info-bg);
            color: var(--info);
        }

        .form-fields {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .form-field-tag {
            padding: 4px 10px;
            background: var(--bg-primary);
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .form-field-tag i {
            font-size: 0.8rem;
        }

        .form-action {
            font-size: 0.9rem;
            color: var(--text-secondary);
            word-break: break-all;
            padding: 10px;
            background: var(--bg-primary);
            border-radius: 6px;
            margin-top: 10px;
        }

        .brand-risks {
            margin-top: 20px;
            padding: 15px;
            background: var(--warning-bg);
            border-radius: 10px;
            border: 1px solid var(--warning);
        }

        .brand-risk-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            font-weight: 500;
        }

        .brand-risk-item.high {
            color: var(--danger);
        }

        .brand-risk-item.medium {
            color: var(--warning);
        }

        .tabs {
            margin-top: 30px;
        }

        .tab-header {
            display: flex;
            gap: 5px;
            border-bottom: 2px solid var(--border);
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .tab-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px 8px 0 0;
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: var(--accent);
            background: var(--info-bg);
        }

        .tab-btn.active {
            color: var(--accent);
            border-bottom: 3px solid var(--accent);
            background: var(--info-bg);
        }

        .tab-content {
            display: none;
            padding: 20px;
            background: var(--bg-primary);
            border-radius: 12px;
        }

        .tab-content.active {
            display: block;
        }

        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .tech-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
        }

        .tech-card h4 {
            margin-bottom: 15px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tech-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .tech-label {
            color: var(--text-secondary);
        }

        .tech-value {
            font-weight: 600;
        }

        .tech-value.good {
            color: var(--success);
        }

        .tech-value.bad {
            color: var(--danger);
        }

        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .indicator-card {
            padding: 15px;
            border-radius: 10px;
        }

        .indicator-card.positive {
            background: var(--success-bg);
        }

        .indicator-card.negative {
            background: var(--danger-bg);
        }

        .indicator-card h4 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .indicator-list {
            list-style: none;
        }

        .indicator-list li {
            padding: 5px 0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recent-scans {
            padding: 40px 0;
        }

        .recent-scans h2 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scans-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .scan-item {
            background: var(--card-bg);
            padding: 15px 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .scan-item:hover {
            border-color: var(--accent);
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.2);
        }

        .scan-url {
            font-weight: 500;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .scan-risk {
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--bg-primary);
        }

        .scan-time {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-bg);
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--border);
            width: 90%;
            max-width: 1000px;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalSlide 0.3s;
        }

        @keyframes modalSlide {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .close {
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close:hover {
            color: var(--danger);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--card-bg);
            border-left: 4px solid;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 3000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        .notification i {
            font-size: 1.2rem;
        }

        .notification.success i {
            color: var(--success);
        }

        .notification.error i {
            color: var(--danger);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ */
        .monitor-page {
            padding: 40px 0;
        }

        .monitor-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .control-panel {
            background: var(--card-bg);
            border-radius: 15px;
            border: 1px solid var(--border);
            padding: 25px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .filter-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .filter-select {
            padding: 12px 20px;
            border-radius: 10px;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            font-size: 0.95rem;
            min-width: 200px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-select:hover,
        .filter-select:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .monitor-table {
            width: 100%;
            border-collapse: collapse;
        }

        .monitor-table thead tr {
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border);
        }

        .monitor-table th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        .monitor-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
        }

        .monitor-table tbody tr:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .category-badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
        }

        .category-casino {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .category-phishing {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .category-pyramid {
            background: rgba(139, 92, 246, 0.15);
            color: #8b5cf6;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .category-suspicious {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .risk-badge {
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 20px;
            display: inline-block;
        }

        .risk-low {
            background: var(--success-bg);
            color: var(--success);
        }

        .risk-medium {
            background: var(--warning-bg);
            color: var(--warning);
        }

        .risk-high {
            background: var(--danger-bg);
            color: var(--danger);
        }

        .action-btn {
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .action-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            transform: translateY(-2px);
        }

        .date-cell {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .domain-cell {
            font-weight: 600;
            color: var(--accent);
        }

        .loading-spinner {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading-spinner i {
            font-size: 2rem;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }

        /* üî• –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ì–†–ê–§–ò–ö–û–í */
        .chart-container {
            background: var(--card-bg);
            border-radius: 15px;
            border: 1px solid var(--border);
            padding: 25px;
            margin-bottom: 30px;
            position: relative;
            height: 400px;
            width: 100%;
        }

        .chart-container canvas {
            display: block;
            width: 100% !important;
            height: 300px !important;
            max-height: 300px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .nav-links {
                display: none;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .result-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .flags-grid {
                grid-template-columns: 1fr;
            }
            
            .phishing-forms {
                grid-template-columns: 1fr;
            }
            
            .tab-header {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                flex: 1 1 auto;
                padding: 10px;
                font-size: 0.9rem;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }

            .control-panel {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .monitor-table {
                display: block;
                overflow-x: auto;
            }

            .chart-container {
                height: 350px;
            }
        }
    </style>
</head>
<body>
    <div class="noise"></div>
    
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-shield-halved"></i>
                <span>CyberScan<span class="accent">AI</span></span>
            </div>
            <div class="nav-links">
                <a href="/" id="homeLink" class="active">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="#" id="historyLink">–ò—Å—Ç–æ—Ä–∏—è</a>
                <a href="#" id="statsLink">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                <a href="/monitor" id="monitorLink">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</a>
            </div>
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </nav>

    <main id="mainContent">
        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Å–∫–∞–Ω–µ—Ä) -->
        <div id="homePage">
            <section class="hero">
                <div class="container">
                    <h1 class="glitch" data-text="CyberScan AI">CyberScan AI</h1>
                    <p class="subtitle">–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å–∞–π—Ç–æ–≤ —Å –≤—ã—è–≤–ª–µ–Ω–∏–µ–º —Ñ–∏—à–∏–Ω–≥–∞ –∏ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞</p>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-chart-line"></i>
                            <div class="stat-value" id="totalScans">{{ total_scans or 0 }}</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–æ–∫</div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div class="stat-value" id="maliciousFound">{{ malicious_found or 0 }}</div>
                            <div class="stat-label">–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —É–≥—Ä–æ–∑</div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-globe"></i>
                            <div class="stat-value" id="uniqueDomains">{{ unique_domains or 0 }}</div>
                            <div class="stat-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤</div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="scan-section">
                <div class="container">
                    <div class="scan-card">
                        <h2>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∞–π—Ç</h2>
                        <p class="scan-description">–í–≤–µ–¥–∏—Ç–µ URL –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞ —Ñ–∏—à–∏–Ω–≥ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</p>
                        
                        <div class="input-group">
                            <input type="url" 
                                   id="urlInput" 
                                   placeholder="https://example.com" 
                                   autocomplete="off"
                                   value="">
                            <button id="scanBtn" class="scan-button">
                                <i class="fas fa-search"></i>
                                <span>–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <div id="resultsContainer"></div>
            <div id="recentScansContainer"></div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ -->
        <div id="monitorPage" style="display: none;">
            <div class="container monitor-page">
                <div class="monitor-header">
                    <h1 class="glitch" data-text="–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É–≥—Ä–æ–∑">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É–≥—Ä–æ–∑</h1>
                    <p class="subtitle">–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–µ–ª–µ–≥–∞–ª—å–Ω—ã—Ö, —Ñ–∏—à–∏–Ω–≥–æ–≤—ã—Ö –∏ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å–∫–∏—Ö —Å–∞–π—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
                </div>
                
                <div class="stats-grid" id="monitorStatsGrid">
                    <div class="stat-card">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="stat-value" id="totalSites">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-dice"></i>
                        <div class="stat-value" id="casinoCount">0</div>
                        <div class="stat-label">–ö–∞–∑–∏–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-fish"></i>
                        <div class="stat-value" id="phishingCount">0</div>
                        <div class="stat-label">–§–∏—à–∏–Ω–≥</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-chart-line"></i>
                        <div class="stat-value" id="pyramidCount">0</div>
                        <div class="stat-label">–§–∏–Ω. –ø–∏—Ä–∞–º–∏–¥—ã</div>
                    </div>
                </div>

                <div class="control-panel">
                    <div class="filter-group">
                        <span class="filter-label">
                            <i class="fas fa-filter"></i>
                            –ö–∞—Ç–µ–≥–æ—Ä–∏—è:
                        </span>
                        <select id="categoryFilter" class="filter-select">
                            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                            <option value="casino">üé∞ –ö–∞–∑–∏–Ω–æ</option>
                            <option value="phishing">üé£ –§–∏—à–∏–Ω–≥</option>
                            <option value="pyramid">üí∞ –§–∏–Ω. –ø–∏—Ä–∞–º–∏–¥—ã</option>
                            <option value="suspicious">‚ö†Ô∏è –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ</option>
                        </select>
                    </div>
                    
                    <button id="refreshBtn" class="scan-button">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                </div>

                <!-- üî• –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ì–†–ê–§–ò–ö–ê -->
                <div class="chart-container" id="trendChartContainer" style="display: none;">
                    <h3><i class="fas fa-chart-line" style="color: var(--accent);"></i> –î–∏–Ω–∞–º–∏–∫–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–π</h3>
                    <canvas id="trendChart"></canvas>
                </div>

                <div class="table-container">
                    <table class="monitor-table" id="sitesTable">
                        <thead>
                            <tr>
                                <th>–î–æ–º–µ–Ω</th>
                                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                <th>–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞</th>
                                <th>–û–±–Ω–∞—Ä—É–∂–µ–Ω</th>
                                <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td colspan="6" class="loading-spinner">
                                    <i class="fas fa-circle-notch"></i>
                                    <div>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞...</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="statsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                <span class="close" onclick="document.getElementById('statsModal').style.display='none'">&times;</span>
            </div>
            <div class="modal-body">
                <div class="chart-container">
                    <canvas id="statsChart"></canvas>
                </div>
                <div id="topMalicious" class="top-list" style="margin-top: 30px;"></div>
            </div>
        </div>
    </div>

    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫</h2>
                <span class="close" onclick="document.getElementById('historyModal').style.display='none'">&times;</span>
            </div>
            <div class="modal-body">
                <div id="historyList"></div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let statsChart = null;
        let trendChart = null;
        let currentTheme = localStorage.getItem('theme') || 'dark';
        let currentCategory = '';
        let currentPage = 'home';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
        document.addEventListener('DOMContentLoaded', function() {
            if (currentTheme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                document.querySelector('#themeToggle i').className = 'fas fa-sun';
            } else {
                document.documentElement.removeAttribute('data-theme');
                document.querySelector('#themeToggle i').className = 'fas fa-moon';
            }

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            setupNavigation();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            loadStats();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
            if (window.location.pathname === '/monitor') {
                showMonitorPage();
                loadMonitorData();
            }
        });

        function setupNavigation() {
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
            document.getElementById('homeLink').addEventListener('click', function(e) {
                e.preventDefault();
                showHomePage();
                window.history.pushState({}, '', '/');
            });

            document.getElementById('monitorLink').addEventListener('click', function(e) {
                e.preventDefault();
                showMonitorPage();
                loadMonitorData();
                window.history.pushState({}, '', '/monitor');
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
            window.addEventListener('popstate', function() {
                if (window.location.pathname === '/monitor') {
                    showMonitorPage();
                    loadMonitorData();
                } else {
                    showHomePage();
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª–æ–∫
            document.getElementById('statsLink').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('statsModal').style.display = 'block';
                loadStatsChart();
            });

            document.getElementById('historyLink').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('historyModal').style.display = 'block';
                loadHistory();
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const urlInput = document.getElementById('urlInput');
            if (urlInput) {
                urlInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        scanUrl();
                    }
                });
            }

            const scanBtn = document.getElementById('scanBtn');
            if (scanBtn) {
                scanBtn.addEventListener('click', scanUrl);
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
            document.getElementById('categoryFilter')?.addEventListener('change', function(e) {
                currentCategory = e.target.value;
                loadMonitorSites();
            });

            document.getElementById('refreshBtn')?.addEventListener('click', function() {
                loadMonitorSites();
                loadTrendData();
                showNotification('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            });

            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        }

        function showHomePage() {
            document.getElementById('homePage').style.display = 'block';
            document.getElementById('monitorPage').style.display = 'none';
            document.getElementById('homeLink').classList.add('active');
            document.getElementById('monitorLink').classList.remove('active');
            currentPage = 'home';
        }

        function showMonitorPage() {
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('monitorPage').style.display = 'block';
            document.getElementById('monitorLink').classList.add('active');
            document.getElementById('homeLink').classList.remove('active');
            currentPage = 'monitor';
        }

        function loadMonitorData() {
            loadMonitorSites();
            loadTrendData();
        }

        // ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´ ==========
        async function scanUrl() {
            const urlInput = document.getElementById('urlInput');
            if (!urlInput) return;
            
            const url = urlInput.value.trim();
            
            if (!url) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ URL –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                return;
            }
            
            let formattedUrl = url;
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                formattedUrl = 'https://' + url;
            }
            
            const scanBtn = document.getElementById('scanBtn');
            const originalText = scanBtn.innerHTML;
            scanBtn.innerHTML = '<span class="loading"></span> –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...';
            scanBtn.disabled = true;
            
            try {
                const encodedUrl = encodeURIComponent(formattedUrl);
                const response = await fetch(`/check/${encodedUrl}`);
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏');
                }
                
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                const newResults = doc.querySelector('.results-section');
                const newRecent = doc.querySelector('.recent-scans');
                
                if (newResults) {
                    const oldResults = document.querySelector('.results-section');
                    if (oldResults) {
                        oldResults.remove();
                    }
                    
                    document.querySelector('#homePage').insertAdjacentHTML('beforeend', newResults.outerHTML);
                    newResults.scrollIntoView({ behavior: 'smooth' });
                }
                
                if (newRecent) {
                    const oldRecent = document.querySelector('.recent-scans');
                    if (oldRecent) {
                        oldRecent.outerHTML = newRecent.outerHTML;
                    }
                }
                
                await loadStats();
                showNotification('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'success');
                
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
                console.error('Scan error:', error);
            } finally {
                scanBtn.innerHTML = originalText;
                scanBtn.disabled = false;
            }
        }

        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                if (!response.ok) return;
                
                const stats = await response.json();
                
                const totalScans = document.getElementById('totalScans');
                const maliciousFound = document.getElementById('maliciousFound');
                const uniqueDomains = document.getElementById('uniqueDomains');
                
                if (totalScans) totalScans.textContent = stats.total_scans || 0;
                if (maliciousFound) maliciousFound.textContent = stats.malicious_found || 0;
                if (uniqueDomains) uniqueDomains.textContent = stats.unique_domains || 0;
                
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê ==========
        async function loadMonitorSites() {
            const tbody = document.getElementById('tableBody');
            if (!tbody) return;

            tbody.innerHTML = '<tr><td colspan="6" class="loading-spinner"><i class="fas fa-circle-notch"></i><div>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div></td></tr>';

            const url = `/api/illegal-sites?limit=100&offset=0${currentCategory ? `&category=${currentCategory}` : ''}`;

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                const data = await response.json();

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('totalSites').textContent = data.statistics?.total || 0;
                const byCategory = data.statistics?.by_category || {};
                document.getElementById('casinoCount').textContent = byCategory.casino || 0;
                document.getElementById('phishingCount').textContent = byCategory.phishing || 0;
                document.getElementById('pyramidCount').textContent = byCategory.pyramid || 0;

                if (!data.sites || data.sites.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td></tr>';
                    return;
                }

                let html = '';
                data.sites.forEach(site => {
                    const categoryClass = {
                        'casino': 'category-casino',
                        'phishing': 'category-phishing',
                        'pyramid': 'category-pyramid',
                        'suspicious': 'category-suspicious'
                    }[site.category] || '';

                    const categoryNames = {
                        'casino': 'üé∞ –ö–∞–∑–∏–Ω–æ',
                        'phishing': 'üé£ –§–∏—à–∏–Ω–≥',
                        'pyramid': 'üí∞ –§–∏–Ω. –ø–∏—Ä–∞–º–∏–¥–∞',
                        'suspicious': '‚ö†Ô∏è –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π'
                    };

                    const riskScore = site.risk_score || 0;
                    const riskClass = riskScore < 30 ? 'risk-low' : (riskScore < 60 ? 'risk-medium' : 'risk-high');

                    const firstSeen = site.first_seen ? new Date(site.first_seen).toLocaleDateString('ru-RU') : 'N/A';
                    const lastSeen = site.last_seen ? new Date(site.last_seen).toLocaleDateString('ru-RU') : 'N/A';

                    html += `
                        <tr>
                            <td class="domain-cell">${site.domain || 'N/A'}</td>
                            <td><span class="category-badge ${categoryClass}">${categoryNames[site.category] || site.category || 'N/A'}</span></td>
                            <td><span class="risk-badge ${riskClass}">${riskScore}%</span></td>
                            <td class="date-cell">${firstSeen}</td>
                            <td class="date-cell">${lastSeen}</td>
                            <td>
                                <button class="action-btn" onclick="checkSite('${site.domain}')">
                                    <i class="fas fa-search"></i> –ê–Ω–∞–ª–∏–∑
                                </button>
                            </td>
                        </tr>
                    `;
                });

                tbody.innerHTML = html;

            } catch (error) {
                console.error('Error loading sites:', error);
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--danger);"><i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            }
        }

        // üî• –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –¢–†–ï–ù–î–û–í
        async function loadTrendData() {
            try {
                const container = document.getElementById('trendChartContainer');
                const canvas = document.getElementById('trendChart');
                
                if (!canvas) return;
                
                const response = await fetch('/api/illegal-sites?limit=1000');
                if (!response.ok) return;

                const data = await response.json();
                
                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –¥–Ω—è–º
                const dailyStats = {};
                
                data.sites.forEach(site => {
                    if (site.first_seen) {
                        const date = new Date(site.first_seen).toLocaleDateString('ru-RU').split('T')[0];
                        if (!dailyStats[date]) {
                            dailyStats[date] = { casino: 0, phishing: 0, pyramid: 0, suspicious: 0 };
                        }
                        if (dailyStats[date][site.category] !== undefined) {
                            dailyStats[date][site.category]++;
                        } else {
                            dailyStats[date].suspicious++;
                        }
                    }
                });
                
                const dates = Object.keys(dailyStats).sort().slice(-30);
                const casinoData = dates.map(d => dailyStats[d].casino || 0);
                const phishingData = dates.map(d => dailyStats[d].phishing || 0);
                const pyramidData = dates.map(d => dailyStats[d].pyramid || 0);
                
                if (dates.length > 0) {
                    container.style.display = 'block';
                    
                    // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫
                    if (trendChart) {
                        trendChart.destroy();
                        trendChart = null;
                    }
                    
                    // –û—á–∏—â–∞–µ–º canvas
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫
                    trendChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: dates,
                            datasets: [{
                                label: '–ö–∞–∑–∏–Ω–æ',
                                data: casinoData,
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                tension: 0.4,
                                fill: false,
                                borderWidth: 2
                            }, {
                                label: '–§–∏—à–∏–Ω–≥',
                                data: phishingData,
                                borderColor: '#ef4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                tension: 0.4,
                                fill: false,
                                borderWidth: 2
                            }, {
                                label: '–ü–∏—Ä–∞–º–∏–¥—ã',
                                data: pyramidData,
                                borderColor: '#8b5cf6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                tension: 0.4,
                                fill: false,
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    labels: {
                                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary'),
                                        font: { size: 12 }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(128, 128, 128, 0.1)'
                                    },
                                    ticks: {
                                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary'),
                                        stepSize: 1,
                                        callback: function(value) {
                                            return Number.isInteger(value) ? value : null;
                                        }
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(128, 128, 128, 0.1)'
                                    },
                                    ticks: {
                                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary'),
                                        maxRotation: 45,
                                        minRotation: 45,
                                        font: { size: 10 }
                                    }
                                }
                            }
                        }
                    });
                } else {
                    container.style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading trend data:', error);
            }
        }

        // ========== –û–ë–©–ò–ï –§–£–ù–ö–¶–ò–ò ==========
        async function loadStatsChart() {
            try {
                const response = await fetch('/api/stats');
                if (!response.ok) return;
                
                const stats = await response.json();
                
                const canvas = document.getElementById('statsChart');
                if (!canvas) return;
                
                if (statsChart) {
                    statsChart.destroy();
                    statsChart = null;
                }
                
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                if (!stats.daily_stats || stats.daily_stats.length === 0) {
                    ctx.font = '16px Inter';
                    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
                    ctx.fillText('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è', 50, 150);
                    return;
                }
                
                statsChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: stats.daily_stats.map(d => d.date),
                        datasets: [{
                            label: '–ü—Ä–æ–≤–µ—Ä–æ–∫ –≤ –¥–µ–Ω—å',
                            data: stats.daily_stats.map(d => d.count || 0),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y',
                            borderWidth: 2
                        }, {
                            label: '–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫',
                            data: stats.daily_stats.map(d => d.avg_risk || 0),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y1',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary'),
                                    font: { size: 12 }
                                }
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                grid: {
                                    color: 'rgba(128, 128, 128, 0.1)'
                                },
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary')
                                },
                                title: {
                                    display: true,
                                    text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–æ–∫',
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary')
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false,
                                },
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary'),
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                title: {
                                    display: true,
                                    text: '–†–∏—Å–∫ (%)',
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary')
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(128, 128, 128, 0.1)'
                                },
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary'),
                                    maxRotation: 45,
                                    minRotation: 45,
                                    font: { size: 10 }
                                }
                            }
                        }
                    }
                });
                
                const topList = document.getElementById('topMalicious');
                if (topList && stats.top_malicious && stats.top_malicious.length > 0) {
                    let html = '<h3 style="margin-bottom: 15px;">–¢–æ–ø –æ–ø–∞—Å–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤</h3>';
                    stats.top_malicious.slice(0, 5).forEach(domain => {
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid var(--border);">
                                <span>${domain.domain}</span>
                                <span style="color: var(--danger);">${Math.round(domain.avg_risk)}% —Ä–∏—Å–∫ (${domain.scans} –ø—Ä–æ–≤–µ—Ä–æ–∫)</span>
                            </div>
                        `;
                    });
                    topList.innerHTML = html;
                }
                
            } catch (error) {
                console.error('Error loading chart:', error);
            }
        }

        async function loadHistory(offset = 0) {
            try {
                const response = await fetch(`/api/history?limit=20&offset=${offset}`);
                if (!response.ok) return;
                
                const data = await response.json();
                
                const historyList = document.getElementById('historyList');
                if (!historyList) return;
                
                if (!data.scans || data.scans.length === 0) {
                    historyList.innerHTML = '<p style="text-align: center; padding: 30px; color: var(--text-secondary);">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>';
                    return;
                }
                
                let html = '';
                data.scans.forEach(scan => {
                    const date = new Date(scan.timestamp);
                    const formattedDate = date.toLocaleString('ru-RU');
                    const riskColor = scan.risk_score < 30 ? 'var(--success)' : (scan.risk_score < 60 ? 'var(--warning)' : 'var(--danger)');
                    
                    html += `
                        <div class="scan-item" onclick="window.location.href='/check/${encodeURIComponent(scan.url)}'" style="background: var(--card-bg); padding: 15px 20px; border-radius: 12px; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; cursor: pointer; transition: all 0.3s;">
                            <div style="display: flex; flex-direction: column; gap: 5px;">
                                <span style="font-weight: 500;">${scan.url}</span>
                                <span style="font-size: 0.8rem; color: var(--text-secondary);">${formattedDate}</span>
                            </div>
                            <span style="color: ${riskColor}; font-weight: 600; padding: 4px 10px; border-radius: 20px; background: ${riskColor}10;">${scan.risk_score}% —Ä–∏—Å–∫</span>
                        </div>
                    `;
                });
                
                if (data.total > offset + 20) {
                    html += `
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="loadHistory(${offset + 20})" class="scan-button" style="display: inline-flex;">
                                <i class="fas fa-chevron-down"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ
                            </button>
                        </div>
                    `;
                }
                
                historyList.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading history:', error);
            }
        }

        function checkSite(domain) {
            if (domain) {
                window.location.href = `/check/${encodeURIComponent(domain)}`;
            }
        }

        function toggleTheme() {
            const root = document.documentElement;
            const icon = document.querySelector('#themeToggle i');
            
            if (currentTheme === 'dark') {
                root.setAttribute('data-theme', 'light');
                if (icon) icon.className = 'fas fa-sun';
                currentTheme = 'light';
            } else {
                root.removeAttribute('data-theme');
                if (icon) icon.className = 'fas fa-moon';
                currentTheme = 'dark';
            }
            
            localStorage.setItem('theme', currentTheme);
            
            if (trendChart) {
                trendChart.options.plugins.legend.labels.color = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
                trendChart.options.scales.y.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
                trendChart.options.scales.x.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
                trendChart.update();
            }
            if (statsChart) {
                statsChart.options.plugins.legend.labels.color = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
                statsChart.options.scales.y.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
                statsChart.options.scales.y1.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
                statsChart.options.scales.x.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
                statsChart.update();
            }
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                padding: 15px 25px;
                background: var(--card-bg);
                border-left: 4px solid ${type === 'success' ? 'var(--success)' : 'var(--danger)'};
                border-radius: 8px;
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
                display: flex;
                align-items: center;
                gap: 12px;
                transform: translateX(400px);
                transition: transform 0.3s;
                z-index: 3000;
                color: var(--text-primary);
            `;
            
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}" style="color: ${type === 'success' ? 'var(--success)' : 'var(--danger)'};"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
